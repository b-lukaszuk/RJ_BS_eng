<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Bartlomiej Lukaszuk" />
  <title>Correlation Pitfalls - Romeo and Julia, where Romeo is Basic Statistics</title>
  <link rel="stylesheet" href="./style.css"/>
    <script src="./mousetrap.min.js"></script>
    <style>
  @font-face {
    font-family: JuliaMono-Regular;
    src: url("./JuliaMono-Regular.woff2");
  }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
  <link rel="stylesheet" href="./github.min.css">
<script src="./highlight.min.js"></script>
<script src="./julia.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', (event) => {
    document.querySelectorAll('pre').forEach((el) => {
        if (!el.classList.contains('output')) {
            hljs.highlightElement(el);
        }
    });
});
</script>
 
</head>
<body>
<script>
function click_next() {
  var next = document.getElementById('nav-next');
  next.firstElementChild.nextElementSibling.click();
}
function click_prev() {
  var prev = document.getElementById('nav-prev');
  prev.firstElementChild.click();
}
Mousetrap.bind('right', click_next);
Mousetrap.bind('h', click_prev);
Mousetrap.bind('left', click_prev);
Mousetrap.bind('l', click_next);
</script>

<div class="books-container">
<aside class="books-menu">
<input type="checkbox" id="menu">
<label for="menu">☰</label>
<div class="books-title">
<a href="./">Romeo and Julia, where Romeo is Basic Statistics</a>
</div><br />
<span class="books-subtitle">

</span>
<div class="books-menu-content">
<li><a class="menu-level-1" href="./about.html"><b>1</b> About</a></li>
<li><a class="menu-level-1" href="./why_julia.html"><b>2</b> Why Julia</a></li>
<li><a class="menu-level-2" href="./julia_is_fast.html"><b>2.1</b> Julia is fast</a></li>
<li><a class="menu-level-2" href="./julia_is_simple.html"><b>2.2</b> Julia is simple</a></li>
<li><a class="menu-level-2" href="./jl_pleasure_to_write.html"><b>2.3</b> Pleasure to write</a></li>
<li><a class="menu-level-2" href="./jl_not_mainstream.html"><b>2.4</b> Not mainstream</a></li>
<li><a class="menu-level-2" href="./jl_open_source.html"><b>2.5</b> Julia is free</a></li>
<li><a class="menu-level-1" href="./julia_first_encounter.html"><b>3</b> Julia - first encounter</a></li>
<li><a class="menu-level-2" href="./julia_installation.html"><b>3.1</b> Installation</a></li>
<li><a class="menu-level-2" href="./julia_language_constructs.html"><b>3.2</b> Language Constructs</a></li>
<li><a class="menu-level-2" href="./julia_language_variables.html"><b>3.3</b> Variables</a></li>
<li><a class="menu-level-2" href="./julia_language_functions.html"><b>3.4</b> Functions</a></li>
<li><a class="menu-level-2" href="./julia_language_decision_making.html"><b>3.5</b> Decision Making</a></li>
<li><a class="menu-level-2" href="./julia_language_repetition.html"><b>3.6</b> Repetition</a></li>
<li><a class="menu-level-2" href="./julia_language_libraries.html"><b>3.7</b> Additional libraries</a></li>
<li><a class="menu-level-2" href="./julia_language_exercises.html"><b>3.8</b> Julia - Exercises</a></li>
<li><a class="menu-level-2" href="./julia_language_exercises_solutions.html"><b>3.9</b> Julia - Solutions</a></li>
<li><a class="menu-level-1" href="./statistics_intro.html"><b>4</b> Statistics - introduction</a></li>
<li><a class="menu-level-2" href="./statistics_intro_imports.html"><b>4.1</b> Chapter imports</a></li>
<li><a class="menu-level-2" href="./statistics_intro_probability_definition.html"><b>4.2</b> Probability - definition</a></li>
<li><a class="menu-level-2" href="./statistics_intro_probability_properties.html"><b>4.3</b> Probability - properties</a></li>
<li><a class="menu-level-2" href="./statistics_prob_theor_practice.html"><b>4.4</b> Probability - theory and..</a></li>
<li><a class="menu-level-2" href="./statistics_prob_distribution.html"><b>4.5</b> Probability distribution</a></li>
<li><a class="menu-level-2" href="./statistics_normal_distribution.html"><b>4.6</b> Normal distribution</a></li>
<li><a class="menu-level-2" href="./statistics_intro_hypothesis_testing.html"><b>4.7</b> Hypothesis testing</a></li>
<li><a class="menu-level-2" href="./statistics_intro_exercises.html"><b>4.8</b> Statistics intro - Exerc..</a></li>
<li><a class="menu-level-2" href="./statistics_intro_exercises_solutions.html"><b>4.9</b> Statistics intro - Solut..</a></li>
<li><a class="menu-level-1" href="./compare_contin_data.html"><b>5</b> Comparisons - continuous d..</a></li>
<li><a class="menu-level-2" href="./compare_contin_data_imports.html"><b>5.1</b> Chapter imports</a></li>
<li><a class="menu-level-2" href="./compare_contin_data_one_samp_ttest.html"><b>5.2</b> One sample Student’s t..</a></li>
<li><a class="menu-level-2" href="./compare_contin_data_two_samp_ttest.html"><b>5.3</b> Two samples Student’s ..</a></li>
<li><a class="menu-level-2" href="./compare_contin_data_one_way_anova.html"><b>5.4</b> One-way ANOVA</a></li>
<li><a class="menu-level-2" href="./compare_contin_data_post_hoc_tests.html"><b>5.5</b> Post-hoc tests</a></li>
<li><a class="menu-level-2" href="./compare_contin_data_multip_correction.html"><b>5.6</b> Multiplicity correction</a></li>
<li><a class="menu-level-2" href="./compare_contin_data_exercises.html"><b>5.7</b> Exercises - Comparisons ..</a></li>
<li><a class="menu-level-2" href="./compare_contin_data_exercises_solutions.html"><b>5.8</b> Solutions - Comparisons ..</a></li>
<li><a class="menu-level-1" href="./compare_categ_data.html"><b>6</b> Comparisons - categorical ..</a></li>
<li><a class="menu-level-2" href="./compare_categ_data_imports.html"><b>6.1</b> Chapter imports</a></li>
<li><a class="menu-level-2" href="./compare_categ_data_flashback.html"><b>6.2</b> Flashback</a></li>
<li><a class="menu-level-2" href="./compare_categ_data_chisq_test.html"><b>6.3</b> Chi squared test</a></li>
<li><a class="menu-level-2" href="./compare_categ_data_fisher_exact_text.html"><b>6.4</b> Fisher’s exact test</a></li>
<li><a class="menu-level-2" href="./compare_categ_data_bigger_table.html"><b>6.5</b> Bigger table</a></li>
<li><a class="menu-level-2" href="./compare_categ_test_for_independence.html"><b>6.6</b> Test for independence</a></li>
<li><a class="menu-level-2" href="./compare_categ_data_exercises.html"><b>6.7</b> Exercises - Comparisons ..</a></li>
<li><a class="menu-level-2" href="./compare_categ_data_exercises_solutions.html"><b>6.8</b> Solutions - Comparisons ..</a></li>
<li><a class="menu-level-1" href="./association.html"><b>7</b> Association</a></li>
<li><a class="menu-level-2" href="./assoc_and_pred_data_imports.html"><b>7.1</b> Chapter imports</a></li>
<li><a class="menu-level-2" href="./association_lin_relation.html"><b>7.2</b> Linear relation</a></li>
<li><a class="menu-level-2" href="./assocociation_covariance.html"><b>7.3</b> Covariance</a></li>
<li><a class="menu-level-2" href="./assoc_and_pred_correlation.html"><b>7.4</b> Correlation</a></li>
<li><a class="menu-level-2" href="./association_corr_pitfalls.html"><b>7.5</b> Correlation Pitfalls</a></li>
<li><a class="menu-level-2" href="./association_exercises.html"><b>7.6</b> Exercises - Association</a></li>
<li><a class="menu-level-2" href="./association_exercises_solutions.html"><b>7.7</b> Solutions - Association</a></li>
<li><a class="menu-level-1" href="./appendix.html"><b></b> Appendix</a></li>
<li><a class="menu-level-1" href="./references.html"><b>8</b> References</a></li>
</div>
</aside>

<div class="books-content">
<h2 data-number="7.5" id="sec:association_corr_pitfalls"><span class="header-section-number">7.5</span> Correlation Pitfalls</h2>
<p>The Pearson correlation coefficient is pretty useful (especially in connection with the Student’s t-test), but it shouldn’t be applied thoughtlessly.</p>
<p>Let’s take a look at the <a href="https://en.wikipedia.org/wiki/Anscombe%27s_quartet">Anscombe’s quartet</a>.</p>
<pre class="language-julia"><code>import RDatasets as RD

anscombe = RD.dataset(&quot;datasets&quot;, &quot;anscombe&quot;)
first(anscombe, 5)
</code></pre>
<div id="tbl:anscombeDf">
<table>
<caption>Table 10: DataFrame for Anscombe’s quartet</caption>
<thead>
<tr class="header">
<th style="text-align: right;">X1</th>
<th style="text-align: right;">X2</th>
<th style="text-align: right;">X3</th>
<th style="text-align: right;">X4</th>
<th style="text-align: right;">Y1</th>
<th style="text-align: right;">Y2</th>
<th style="text-align: right;">Y3</th>
<th style="text-align: right;">Y4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10.0</td>
<td style="text-align: right;">10.0</td>
<td style="text-align: right;">10.0</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">8.04</td>
<td style="text-align: right;">9.14</td>
<td style="text-align: right;">7.46</td>
<td style="text-align: right;">6.58</td>
</tr>
<tr class="even">
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">6.95</td>
<td style="text-align: right;">8.14</td>
<td style="text-align: right;">6.77</td>
<td style="text-align: right;">5.76</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13.0</td>
<td style="text-align: right;">13.0</td>
<td style="text-align: right;">13.0</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">7.58</td>
<td style="text-align: right;">8.74</td>
<td style="text-align: right;">12.74</td>
<td style="text-align: right;">7.71</td>
</tr>
<tr class="even">
<td style="text-align: right;">9.0</td>
<td style="text-align: right;">9.0</td>
<td style="text-align: right;">9.0</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">8.81</td>
<td style="text-align: right;">8.77</td>
<td style="text-align: right;">7.11</td>
<td style="text-align: right;">8.84</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11.0</td>
<td style="text-align: right;">11.0</td>
<td style="text-align: right;">11.0</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">8.33</td>
<td style="text-align: right;">9.26</td>
<td style="text-align: right;">7.81</td>
<td style="text-align: right;">8.47</td>
</tr>
</tbody>
</table>
</div>
<p>The data frame is part of <a href="https://github.com/JuliaStats/RDatasets.jl">RDatasets</a> that contains a collection of standard datasets used in the <a href="https://en.wikipedia.org/wiki/R_(programming_language)">R programming language</a>. The data frame was carefully designed to demonstrate the perils of relying blindly on correlation coefficients.</p>
<pre>
fig = Cmk.Figure()
i = 0
for r in 1:2
    for c in 1:2
        i += 1
        xname = string("X", i)
        yname = string("Y", i)
        xs = anscombe[:, xname]
        ys = anscombe[:, yname]
        cor, pval = getCorAndPval(xs, ys)
        Cmk.scatter(fig[r, c], xs, ys,
            axis=(;
                title=string("Figure ", "ABCD"[i]),
                xlabel=xname, ylabel=yname,
                limits=(0, 20, 0, 15)
            ))
        Cmk.text!(fig[r, c], 9, 3,
            text="cor(x, y) = $(round(cor, digits=2))")
        Cmk.text!(fig[r, c], 9, 1,
            text="p-val = $(round(pval, digits=4))")
    end
end

fig
</pre>
<p>There’s not much to explain here. The only new part is <code>string</code> function that converts its elements to strings (if they aren’t already) and glues them together into a one long string. The rest is just plain drawing with <code>CairoMakie</code>. Still, take a look at the picture below</p>
<figure>
<img src="./images/ch07AnscombesQuartet.png" id="fig:ch07AnscombesQuartet" alt="Figure 29: Anscombe’s Quartet." /><figcaption aria-hidden="true">Figure 29: Anscombe’s Quartet.</figcaption>
</figure>
<p>All the sub-figures from Figure <a href="#fig:ch07AnscombesQuartet">29</a> depict different relation types between the X and Y variables, yet the correlations and p-values are the same. Two points of notice here. In <strong>Figure B</strong> the points lie in a perfect order on a curve. So, in a perfect word the correlation coefficient should be equal to 1. Yet it is not, as it only measures the spread of the points around an imaginary straight line. Moreover, correlation is sensitive to <a href="https://en.wikipedia.org/wiki/Outlier">outliers</a>. In <strong>Figure D</strong> the X and Y variables appear not to be associated at all. Again, in the perfect world the correlation coefficient should be equal to 0. Still, the outlier on far right (that in real life may have occurred by a typographical error) pumps it up to 0.82 (or what we could call a very strong correlation). Lesson to be learned here, don’t trust the numbers, and whenever you can draw a scatter plot to double check them. And remember, <a href="https://en.wikipedia.org/wiki/All_models_are_wrong">“All models are wrong, but some are useful”</a>.</p>
<p>Other pitfalls are also possible. For instance, imagine you measured body and tail length of a certain species of mouse, here are your results.</p>
<pre class="language-julia"><code># if you are in &#39;code_snippets&#39; folder, then use: &quot;./ch07/miceLengths.csv&quot;
# if you are in &#39;ch07&#39; folder, then use: &quot;./miceLengths.csv&quot;
miceLengths = Csv.read(
    &quot;./code_snippets/ch07/miceLengths.csv&quot;,
    Dfs.DataFrame)
first(miceLengths, 5)
</code></pre>
<div id="tbl:miceLengthsDf">
<table>
<caption>Table 11: Body lengths of a certain mouse species (fictitious data).</caption>
<thead>
<tr class="header">
<th style="text-align: right;">bodyCm</th>
<th style="text-align: right;">tailCm</th>
<th style="text-align: right;">sex</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">11.3</td>
<td style="text-align: right;">2.55</td>
<td style="text-align: right;">f</td>
</tr>
<tr class="even">
<td style="text-align: right;">11.18</td>
<td style="text-align: right;">2.22</td>
<td style="text-align: right;">f</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9.42</td>
<td style="text-align: right;">2.54</td>
<td style="text-align: right;">f</td>
</tr>
<tr class="even">
<td style="text-align: right;">9.21</td>
<td style="text-align: right;">2.2</td>
<td style="text-align: right;">f</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9.97</td>
<td style="text-align: right;">2.63</td>
<td style="text-align: right;">f</td>
</tr>
</tbody>
</table>
</div>
<p>You are interested to know if the tail length is associated with the body length of the animals.</p>
<pre class="language-julia"><code>getCorAndPval(miceLengths.bodyCm, miceLengths.tailCm)</code></pre>
<pre class="output"><code>(0.8899347709623199, 1.5005298337200657e-7)</code></pre>
<p>Clearly it is and even very strongly. Or is it? Well let’s take a look</p>
<figure>
<img src="./images/ch07miceLengths.png" id="fig:ch07miceBodyLengths" alt="Figure 30: Mice body length vs. tail length." /><figcaption aria-hidden="true">Figure 30: Mice body length vs. tail length.</figcaption>
</figure>
<p>It turns out that we have two clusters of points. In both of them the points seem to be randomly scattered. This could be confirmed by testing correlation coefficient for the clusters.</p>
<pre class="language-julia"><code># fml - female mice lengths
# mml - male mice lengths
fml = miceLengths[miceLengths.sex .== &quot;f&quot;, :] # choose only females
mml = miceLengths[miceLengths.sex .== &quot;m&quot;, :] # choose only males

(
    getCorAndPval(fml.bodyCm, fml.tailCm),
    getCorAndPval(mml.bodyCm, mml.tailCm)
)</code></pre>
<pre class="output"><code>((-0.1593819718041706, 0.6821046994037891),
 (-0.02632446813765732, 0.9387606491398499))</code></pre>
<p>The Pearson correlation coefficients are small and not statistically significant (p &gt; 0.05). But since the two clusters of points lie on the opposite sides of the graph, then the overall correlation measures their spread alongside the imaginary dashed line in Figure <a href="#fig:ch07miceBodyLengths">30</a>. This inflates the value of the coefficient. Therefore, it is always good to inspect a graph (scatter plot) to see if there are any clusters of points. The clusters are usually a result of some grouping present in the data (either different experimental groups/treatments or due to some natural grouping). Sometimes we may be unaware of the groups in our data set. Still, if we do know about them, then it is a good idea to inspect the overall correlation and the correlation coefficients for each of the groups.</p>
<p>As the last example let’s take a look at this data frame.</p>
<pre class="language-julia"><code># if you are in &#39;code_snippets&#39; folder, then use: &quot;./ch07/candyBars.csv&quot;
# if you are in &#39;ch07&#39; folder, then use: &quot;./candyBars.csv&quot;
candyBars = Csv.read(
    &quot;./code_snippets/ch07/candyBars.csv&quot;,
    Dfs.DataFrame)
first(candyBars, 5)
</code></pre>
<div id="tbl:candyBarsDf">
<table>
<caption>Table 12: Candy bar composition [g] (fictitious data).</caption>
<thead>
<tr class="header">
<th style="text-align: right;">total</th>
<th style="text-align: right;">carb</th>
<th style="text-align: right;">fat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">44.49</td>
<td style="text-align: right;">30.23</td>
<td style="text-align: right;">9.67</td>
</tr>
<tr class="even">
<td style="text-align: right;">48.39</td>
<td style="text-align: right;">29.31</td>
<td style="text-align: right;">12.48</td>
</tr>
<tr class="odd">
<td style="text-align: right;">49.83</td>
<td style="text-align: right;">30.95</td>
<td style="text-align: right;">10.58</td>
</tr>
<tr class="even">
<td style="text-align: right;">40.51</td>
<td style="text-align: right;">25.22</td>
<td style="text-align: right;">9.89</td>
</tr>
<tr class="odd">
<td style="text-align: right;">44.51</td>
<td style="text-align: right;">29.45</td>
<td style="text-align: right;">10.15</td>
</tr>
</tbody>
</table>
</div>
<p>Here, we got a data set on composition of different chocolate bars. You are interested to see if the carbohydrate (<code>carb</code>) content in bars is associated with their fat mass.</p>
<pre class="language-julia"><code>getCorAndPval(candyBars.carb, candyBars.fat)</code></pre>
<pre class="output"><code>(0.12176486958519656, 0.7375535843598793)</code></pre>
<p>And it appears it is not. OK, no big deal, and what about <code>carb</code> and <code>total</code> mass of a candy bar?</p>
<pre class="language-julia"><code>getCorAndPval(candyBars.carb, candyBars.total)</code></pre>
<pre class="output"><code>(0.822779226943004, 0.0034638410860259317)</code></pre>
<p>Now we got it. It’s big (r &gt; 0.8) and it’s real (<span class="math inline">\(p \le 0.05\)</span>). But did it really make sense to test that?</p>
<p>If we got a random variable <code>aa</code> then it is going to be perfectly correlated with itself.</p>
<pre class="language-julia"><code>import Random as Rand

Rand.seed!(321)
aa = Rand.rand(Dsts.Normal(100, 15), 10)

getCorAndPval(aa, aa)</code></pre>
<pre class="output"><code>(1.0, 0.0)</code></pre>
<p>On the other hand it shouldn’t be correlated with another random variable <code>bb</code>.</p>
<pre class="language-julia"><code>bb = Rand.rand(Dsts.Normal(100, 15), 10)

getCorAndPval(aa, bb)</code></pre>
<pre class="output"><code>(0.1939999719555875, 0.5912393958185727)</code></pre>
<p>Now, if we add the two variables together we will get the total (<code>cc</code>), that will be correlated with both <code>aa</code> and <code>bb</code>.</p>
<pre class="language-julia"><code>cc = aa .+ bb

(
    getCorAndPval(aa, cc),
    getCorAndPval(bb, cc)
)</code></pre>
<pre class="output"><code>((0.7813386818990972, 0.007608814877251735),
 (0.7638298560460359, 0.01012008535535891))</code></pre>
<p>This is because while correlating <code>aa</code> with <code>cc</code> we are partially correlating <code>aa</code> with itself (<code>aa .+ bb</code>). In general, the greater portion of <code>cc</code> our <code>aa</code> makes the greater the correlation coefficient. So, although possible, it makes little logical sense to compare a part of something with its total. Therefore, in reality running <code>getCorAndPval(candyBars.carb, candyBars.total)</code> makes no point despite the interesting result it seems to produce.</p>


<div class="bottom-nav">
    <p id="nav-prev" style="text-align: left;">
        <a class="menu-level-2" href="./assoc_and_pred_correlation.html"><b>7.4</b> Correlation</a> <kbd>←</kbd>
        <span id="nav-next" style="float: right;">
            <kbd>→</kbd> <a class="menu-level-2" href="./association_exercises.html"><b>7.6</b> Exercises - Association</a>
        </span>
    </p>
</div>


<div class="license">
    <br/>
  <br/>
  <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
    Bartlomiej Lukaszuk
</div>
</div>
</div>
</body>
</html>